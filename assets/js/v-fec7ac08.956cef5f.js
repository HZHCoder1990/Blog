"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[5194],{7619:(e,n,s)=>{s.r(n),s.d(n,{data:()=>r});const r={key:"v-fec7ac08",path:"/iOS/keychain.html",title:"",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:3,title:"钥匙串学习",slug:"钥匙串学习",children:[]}],filePathRelative:"iOS/keychain.md",git:{updatedTime:1633942617e3,contributors:[{name:"peak",email:"peak@jiemogame.com",commits:1}]}}},3592:(e,n,s)=>{s.r(n),s.d(n,{default:()=>v});var r=s(6252),a=s(6271);const l=(0,r._)("h3",{id:"钥匙串学习",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#钥匙串学习","aria-hidden":"true"},"#"),(0,r.Uk)(" 钥匙串学习")],-1),i=(0,r._)("p",null,"基本概念",-1),c=(0,r._)("blockquote",null,[(0,r._)("p",null,"Securely store small chunks of data on behalf of the user.")],-1),_=(0,r._)("p",null,"除了存储数据本身，还可以提供一组公开可见的属性，以控制项目的可访问性并使其可搜索。",-1),t=(0,r._)("p",null,[(0,r._)("img",{src:a,alt:"putting-data-and-attributes-into-a-keychain"})],-1),b=(0,r._)("p",null,[(0,r._)("code",null,"keychain"),(0,r.Uk)(" 存储类别分为："),(0,r._)("code",null,"kSecClassInternetPassword"),(0,r.Uk)(" , "),(0,r._)("code",null,"kSecClassGenericPassword"),(0,r.Uk)(" , "),(0,r._)("code",null,"kSecClassCertificate"),(0,r.Uk)(" , "),(0,r._)("code",null,"kSecClassKey"),(0,r.Uk)(" , "),(0,r._)("code",null,"kSecClassIdentity")],-1),u=(0,r._)("p",null,[(0,r.Uk)("可以用 "),(0,r._)("code",null,"kSecClass"),(0,r.Uk)(" 来指定存储数据的类别。")],-1),p=(0,r._)("p",null,[(0,r._)("code",null,"kSecClassGenericPassword"),(0,r.Uk)(" 类型有如下属性：")],-1),m=(0,r._)("div",{class:"language-text ext-text line-numbers-mode"},[(0,r._)("pre",{class:"language-text"},[(0,r._)("code",null,"kSecClassGenericPassword item attributes:\n        kSecAttrAccess (OS X only)\n        kSecAttrAccessControl\n        kSecAttrAccessGroup (iOS; also OS X if kSecAttrSynchronizable specified) // 用于指定多个APP共享数据\n        kSecAttrAccessible (iOS; also OS X if kSecAttrSynchronizable specified)\n        kSecAttrCreationDate \n        kSecAttrModificationDate \n        kSecAttrDescription \n        kSecAttrComment\n        kSecAttrCreator\n        kSecAttrType\n        kSecAttrLabel\n        kSecAttrIsInvisible\n        kSecAttrIsNegative\n        kSecAttrAccount\n        kSecAttrService\n        kSecAttrGeneric\n        kSecAttrSynchronizable\n")]),(0,r._)("div",{class:"line-numbers"},[(0,r._)("span",{class:"line-number"},"1"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"2"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"3"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"4"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"5"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"6"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"7"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"8"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"9"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"10"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"11"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"12"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"13"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"14"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"15"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"16"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"17"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"18"),(0,r._)("br")])],-1),o=(0,r._)("p",null,"主要API接口",-1),d=(0,r._)("div",{class:"language-objective ext-objective line-numbers-mode"},[(0,r._)("pre",{class:"language-objective"},[(0,r._)("code",null,"// 增\nOSStatus SecItemAdd(CFDictionaryRef attributes, CFTypeRef * __nullable CF_RETURNS_RETAINED result);\n// 删\nOSStatus SecItemDelete(CFDictionaryRef query);\n// 改\nOSStatus SecItemUpdate(CFDictionaryRef query, CFDictionaryRef attributesToUpdate);\n// 查\nOSStatus SecItemCopyMatching(CFDictionaryRef query, CFTypeRef * __nullable CF_RETURNS_RETAINED result);\n")]),(0,r._)("div",{class:"line-numbers"},[(0,r._)("span",{class:"line-number"},"1"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"2"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"3"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"4"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"5"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"6"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"7"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"8"),(0,r._)("br")])],-1),S=(0,r._)("p",null,"简单示例代码:",-1),y=(0,r._)("div",{class:"language-objective ext-objective line-numbers-mode"},[(0,r._)("pre",{class:"language-objective"},[(0,r._)("code",null,'// 设置账号密码\n+ (BOOL)setPassword:(NSString *)password account:(NSString *)account service:(NSString *)service {\n    if (!account || !service || !password) {\n        return NO;\n    }\n    \n    NSMutableDictionary *dic = [self queryDic];\n    dic[(__bridge id)kSecAttrAccount] = account;\n    dic[(__bridge id)kSecAttrService] = service;\n    dic[(__bridge id)kSecValueData] = [password dataUsingEncoding:NSUTF8StringEncoding];\n    \n    OSStatus status = SecItemAdd((__bridge CFDictionaryRef)dic, NULL);\n    if (status != errSecSuccess) {\n        return NO;\n    }\n    return YES;\n}\n\n// 更新账号密码\n+ (BOOL)updatePassword:(NSString *)password account:(NSString *)account service:(NSString *)service {\n    if (!account || !service || !password) {\n        return NO;\n    }\n    \n    NSMutableDictionary *query = [self queryDic];\n    query[(__bridge id)kSecAttrAccount] = account;\n    query[(__bridge id)kSecAttrService] = service;\n    \n    NSMutableDictionary *update = [NSMutableDictionary dictionary];\n    update[(__bridge id)kSecAttrAccount] = account;\n    update[(__bridge id)kSecAttrService] = service;\n    update[(__bridge id)kSecValueData] = [password dataUsingEncoding:NSUTF8StringEncoding];\n    \n    OSStatus status = SecItemUpdate((__bridge CFDictionaryRef)query, (__bridge CFDictionaryRef)update);\n    if (status != errSecSuccess) {\n        return NO;\n    }\n    return YES;\n}\n\n// 查询密码\n+ (NSDictionary *)getPassword:(NSString *)account service:(NSString *)service {\n    if (!account || !service) {\n        return nil;\n    }\n    \n    NSMutableDictionary *query = [self queryDic];\n    query[(__bridge id)kSecAttrAccount] = account;\n    query[(__bridge id)kSecAttrService] = service;\n    query[(__bridge id)kSecMatchLimit] = (__bridge id)kSecMatchLimitOne; // 查询匹配上的第一条数据\n    query[(__bridge id)kSecReturnAttributes] = CFBridgingRelease(kCFBooleanTrue);\n    query[(__bridge id)kSecReturnData] = CFBridgingRelease(kCFBooleanTrue);\n    \n    CFTypeRef result = NULL;\n    OSStatus status = SecItemCopyMatching((__bridge CFDictionaryRef)query, &result);\n    if (status != errSecSuccess) {\n        return nil;\n    }\n    if (!result) return nil;\n    \n    return [self resultDic:(__bridge NSDictionary *)result];\n}\n\n// 查询所有的密码\n+ (NSArray *)getAllPassword:(NSString *)service {\n    if (!service) return nil;\n    NSMutableDictionary *query = [self queryDic];\n    query[(__bridge id)kSecAttrService] = service;\n    query[(__bridge id)kSecMatchLimit] = (__bridge id)kSecMatchLimitAll; // 查询所有数据\n    query[(__bridge id)kSecReturnAttributes] = CFBridgingRelease(kCFBooleanTrue);\n    query[(__bridge id)kSecReturnData] = CFBridgingRelease(kCFBooleanTrue);\n    \n    CFTypeRef result = NULL;\n    OSStatus status = SecItemCopyMatching((__bridge CFDictionaryRef)query, &result);\n    if (status != errSecSuccess) {\n        return nil;\n    }\n    \n    if (!result) return nil;\n    \n    NSMutableArray *res = [NSMutableArray new];\n    if (CFGetTypeID(result) == CFDictionaryGetTypeID()) {\n        [res addObject:[self resultDic:(__bridge NSDictionary *)result]];\n    } else if (CFGetTypeID(result) == CFArrayGetTypeID()) {\n        for (NSDictionary *dic in (__bridge NSArray *)result) {\n            [res addObject:[self resultDic:dic]];\n        }\n    }\n    \n    return res;\n}\n\n// 删除账号\n+ (BOOL)deletePassword:(NSString *)account service:(NSString *)service {\n    if (!account || !service) {\n        return NO;\n    }\n    NSMutableDictionary *queryDic = [self queryDic];\n    [queryDic setObject:account forKey:(__bridge id)kSecAttrAccount];\n    [queryDic setObject:service forKey:(__bridge id)kSecAttrService];\n    \n    OSStatus status = SecItemDelete((__bridge CFDictionaryRef)queryDic);\n    if (status != errSecSuccess) {\n        return NO;\n    }\n    return YES;\n}\n\n+ (NSMutableDictionary *)queryDic {\n    NSMutableDictionary *dic = [NSMutableDictionary dictionary];\n    dic[(__bridge id)kSecClass] = (__bridge id)kSecClassGenericPassword;\n    return dic;\n}\n\n+ (NSDictionary *)resultDic:(NSDictionary *)dic {\n    NSMutableDictionary *ret = [NSMutableDictionary new];\n    NSString *account = [dic objectForKey:(__bridge id)kSecAttrAccount];\n    if (account) {\n        [ret setObject:account forKey:@"account"];\n    }\n    NSString *password = [[NSString alloc] initWithData:[dic objectForKey:(__bridge id)kSecValueData] encoding:NSUTF8StringEncoding];\n    if (password) {\n        [ret setObject:password forKey:@"password"];\n    }\n    \n    return [ret copy];\n}\n')]),(0,r._)("div",{class:"line-numbers"},[(0,r._)("span",{class:"line-number"},"1"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"2"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"3"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"4"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"5"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"6"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"7"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"8"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"9"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"10"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"11"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"12"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"13"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"14"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"15"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"16"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"17"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"18"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"19"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"20"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"21"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"22"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"23"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"24"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"25"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"26"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"27"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"28"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"29"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"30"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"31"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"32"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"33"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"34"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"35"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"36"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"37"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"38"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"39"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"40"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"41"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"42"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"43"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"44"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"45"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"46"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"47"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"48"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"49"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"50"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"51"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"52"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"53"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"54"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"55"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"56"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"57"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"58"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"59"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"60"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"61"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"62"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"63"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"64"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"65"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"66"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"67"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"68"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"69"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"70"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"71"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"72"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"73"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"74"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"75"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"76"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"77"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"78"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"79"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"80"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"81"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"82"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"83"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"84"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"85"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"86"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"87"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"88"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"89"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"90"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"91"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"92"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"93"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"94"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"95"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"96"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"97"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"98"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"99"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"100"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"101"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"102"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"103"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"104"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"105"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"106"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"107"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"108"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"109"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"110"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"111"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"112"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"113"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"114"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"115"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"116"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"117"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"118"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"119"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"120"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"121"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"122"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"123"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"124"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"125"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"126"),(0,r._)("br"),(0,r._)("span",{class:"line-number"},"127"),(0,r._)("br")])],-1),g=(0,r._)("h5",{id:"参考链接",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#参考链接","aria-hidden":"true"},"#"),(0,r.Uk)(" 参考链接")],-1),k={href:"https://developer.apple.com/documentation/security/keychain_services?language=objc",target:"_blank",rel:"noopener noreferrer"},f=(0,r.Uk)("Keychain Services"),D={href:"https://developer.apple.com/library/archive/samplecode/GenericKeychain/Introduction/Intro.html",target:"_blank",rel:"noopener noreferrer"},A=(0,r.Uk)("GenericKeychain"),N={},v=(0,s(3744).Z)(N,[["render",function(e,n){const s=(0,r.up)("OutboundLink");return(0,r.wg)(),(0,r.iD)(r.HY,null,[l,i,c,_,t,b,u,p,m,o,d,S,y,g,(0,r._)("ul",null,[(0,r._)("li",null,[(0,r._)("a",k,[f,(0,r.Wm)(s)])]),(0,r._)("li",null,[(0,r._)("a",D,[A,(0,r.Wm)(s)])])])],64)}]])},3744:(e,n)=>{n.Z=(e,n)=>{for(const[s,r]of n)e[s]=r;return e}},6271:(e,n,s)=>{e.exports=s.p+"assets/img/putting-data-and-attributes-into-a-keychain.e384a70e.png"}}]);